<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.medical.mapper.DoctorMapper">

    <select id="page" resultType="doctorPageQueryVO">
        select d.id, d.doctor_no, d.username, d.real_name, d.gender, d.age, d.phone, d.email, d.id_card,
               d.title, d.department_id, d.specialty, d.work_years, d.introduction, d.status,
               d.avatar, d.create_time, d.update_time, d.create_admin, d.update_admin,
               dept.dept_name as dept_name,
               case when dept.director_id = d.id then true else false end as is_director
        from doctor d
        left join department dept on d.department_id = dept.id
        <where>
            <if test="realName != null and realName != ''">
                and d.real_name like concat('%',#{realName},'%')
            </if>
            <if test="departmentId != null">
                and d.department_id = #{departmentId}
            </if>
            <if test="status != null">
                and d.status = #{status}
            </if>
        </where>
        order by d.id asc
    </select>

    <update id="update">
        update doctor
        <set>
            <if test="username != null">
                username = #{username},
            </if>
            <if test="password != null">
                password = #{password},
            </if>
            <if test="realName != null">
                real_name = #{realName},
            </if>
            <if test="gender != null">
                gender = #{gender},
            </if>
            <if test="age != null">
                age = #{age},
            </if>
            <if test="phone != null">
                phone = #{phone},
            </if>
            <if test="email != null">
                email = #{email},
            </if>
            <if test="idCard != null">
                id_card = #{idCard},
            </if>
            <if test="departmentId != null">
                department_id = #{departmentId},
            </if>
            <if test="title != null">
                title = #{title},
            </if>
            <if test="specialty != null">
                specialty = #{specialty},
            </if>
            <if test="workYears != null">
                work_years = #{workYears},
            </if>
            <if test="introduction != null">
                introduction = #{introduction},
            </if>
            <if test="status != null">
                status = #{status},
            </if>

            <if test="avatar != null">
                avatar = #{avatar},
            </if>
            <!-- 系统字段 -->
            <if test="updateTime != null">
                update_time = #{updateTime},
            </if>
            <if test="updateAdmin != null">
                update_admin = #{updateAdmin},
            </if>
        </set>
        where id = #{id}
    </update>

    <!-- 新增医生 -->
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        insert into doctor (doctor_no, username, password, real_name, gender, age, phone, email, id_card,
                           department_id, title, specialty, work_years, introduction, avatar, status,
                           create_time, update_time, create_admin, update_admin)
        values (#{doctorNo}, #{username}, #{password}, #{realName}, #{gender}, #{age}, #{phone}, #{email}, #{idCard},
                #{departmentId}, #{title}, #{specialty}, #{workYears}, #{introduction}, #{avatar}, #{status},
                #{createTime}, #{updateTime}, #{createAdmin}, #{updateAdmin})
    </insert>

    <!-- 根据ID查询医生 -->
    <select id="getById" resultType="doctor">
        select * from doctor where id = #{id}
    </select>

    <!-- 批量删除 -->
    <delete id="deleteByIds">
        delete from doctor where id in
        <foreach collection="ids" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <!-- 获取医生选项 -->
    <select id="options" resultType="com.medical.options.DoctorOptions">
        select id, real_name as doctorName from doctor where status in (1,2) order by real_name
    </select>

</mapper>
